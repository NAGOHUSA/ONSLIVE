<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Space Weather ‚Ä¢ ournightsky.us</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --bg: #0a0e17;
      --card: rgba(20,25,45,0.75);
      --border: rgba(100,120,255,0.15);
      --text: #e6edf3;
      --text-muted: #94a3b8;
      --cyan: #00d4ff;
      --purple: #a855f7;
      --gold: #fbbf24;
      --red: #ef4444;
      --green: #10b981;
      --accent: var(--cyan);
      --gradient: linear-gradient(135deg,#1e1b4b,#0f172a);
    }

    [data-theme="light"] {
      --bg: #ffffff;
      --card: #f0f0f0;
      --border: #ccc;
      --text: #222;
      --text-muted: #555;
      --cyan: #007acc;
      --purple: #6336e4;
      --accent: #007acc;
      --gradient: linear-gradient(135deg, #e0e0ff, #f5faff);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial;
      min-height: 100vh;
      color: var(--text);
      background: var(--gradient) fixed;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(20px);
      background: rgba(10,14,23,0.9);
      border-bottom: 1px solid var(--border);
      padding: 1rem 0;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    h1 {
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      background: linear-gradient(135deg,var(--cyan),var(--purple));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    #refresh-btn {
      background: linear-gradient(135deg,var(--cyan),var(--purple));
      border: none;
      color: #fff;
      padding: 0.6rem 1.2rem;
      border-radius: 40px;
      cursor: pointer;
      font-weight: 600;
      transition: opacity 0.3s;
    }

    #refresh-btn:hover { opacity: 0.9; }
    #refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* THEME TOGGLE + EXPORT */
    .header-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .export {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .export:hover {
      opacity: 0.85;
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <h1><i class="fas fa-satellite"></i> live.ournightsky.us 1.0</h1>
      <div class="header-controls">
        <label style="cursor:pointer;color:var(--text-muted)">
          <input type="checkbox" id="theme-toggle" />
          <span style="margin-left:0.3rem">üåô/‚òÄÔ∏è</span>
        </label>
        <span style="color:var(--text-muted);">
          Last updated: <strong id="update-time">--:--</strong>
        </span>
        <button id="refresh-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
        <button class="export" onclick="exportDashboard()">Export</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="grid">
      <!-- Aurora Map Card -->
      <div class="card full-width" id="aurora-map-card">
        <h2><i class="fas fa-map"></i> Live Aurora Oval Map</h2>
        <div style="position:relative">
          <div class="map-controls">
            <button class="map-btn active" id="btn-north">Northern</button>
            <button class="map-btn" id="btn-south">Southern</button>
            <button class="map-btn" id="btn-refresh-map"><i class="fas fa-redo"></i></button>
          </div>
          <div id="aurora-map" style="height:360px;border-radius:12px;background:#000;position:relative"></div>
          <div class="aurora-legend">
            <div style="font-weight:bold;margin-bottom:6px;color:#00ffaa">Aurora Intensity</div>
            <div class="aurora-intensity"><span style="background:#ff0066"></span> Extreme (Kp ‚â• 8)</div>
            <div class="aurora-intensity"><span style="background:#ff5500"></span> Strong (Kp 6‚Äì7)</div>
            <div class="aurora-intensity"><span style="background:#ffff00"></span> Moderate (Kp 4‚Äì5)</div>
            <div class="aurora-intensity"><span style="background:#00ffaa"></span> Low (Kp 0‚Äì3)</div>
          </div>
        </div>
        <small style="display:block;margin-top:8px;text-align:center;color:var(--text-muted)">
          Dynamic aurora visualization based on real-time Kp index
        </small>
      </div>

      <!-- News Feed Card -->
      <div class="card full-width" id="news-feed-card">
        <h2><i class="fas fa-newspaper"></i> Latest Space News</h2>
        <div id="news-feed" class="loading">Loading...</div>
      </div>
    </div>
  </div>
<main class="container">
  <!-- Hero Section: Kp Index Gauge -->
  <section class="hero">
    <h2><i class="fas fa-compass"></i> Current Space Weather Activity</h2>
    <div class="gauge-container" id="kp-gauge">
      <svg viewBox="0 0 200 120" preserveAspectRatio="xMidYMid meet">
        <defs>
          <linearGradient id="kp-grad">
            <stop offset="0%" stop-color="#10b981"/>
            <stop offset="50%" stop-color="#fbbf24"/>
            <stop offset="100%" stop-color="#ef4444"/>
          </linearGradient>
        </defs>
        <path d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="#334155" stroke-width="16"></path>
        <path id="kp-arc" d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="url(#kp-grad)" stroke-width="16" stroke-linecap="round" stroke-dasharray="0 251.3"></path>
        <circle cx="100" cy="100" r="8" fill="#fff"></circle>
        <text x="100" y="65" text-anchor="middle" class="gauge-value" id="kp-value">--</text>
      </svg>
      <div class="needle" id="kp-needle"></div>
    </div>
    <p id="aurora-message" style="margin-top:1rem;color:var(--text-muted)">Loading aurora summary...</p>
  </section>

  <!-- Main Dashboard Grid -->
  <div class="main-content-grid" id="dashboard-grid">
    <!-- Solar Activity -->
    <div class="card" id="solar-activity-card" data-group="solar">
      <h2><i class="fas fa-sun"></i> Solar Activity</h2>
      <div id="solar-data" class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
    </div>

    <!-- X-ray Gauge -->
    <div class="card" id="xray-gauge-card" data-group="solar">
      <h2><i class="fas fa-radiation"></i> Solar Radiation (X-ray)</h2>
      <div class="gauge-container" id="xray-gauge">
        <svg viewBox="0 0 200 120">
          <defs><linearGradient id="xray-grad"><stop offset="0%" stop-color="#10b981"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#ef4444"/></linearGradient></defs>
          <path d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="#334155" stroke-width="16"/>
          <path id="xray-arc" d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="url(#xray-grad)" stroke-width="16" stroke-linecap="round" stroke-dasharray="0 251.3"></path>
          <circle cx="100" cy="100" r="8" fill="#fff"></circle>
          <text x="100" y="65" text-anchor="middle" class="gauge-value" id="xray-value">--</text>
        </svg>
        <div class="needle" id="xray-needle"></div>
      </div>
      <div id="xray-info" class="loading"></div>
    </div>

    <!-- Dst Index -->
    <div class="card" id="dst-card" data-group="solar">
      <h2><i class="fas fa-magnet"></i> Geomagnetic Storms (Dst)</h2>
      <div class="gauge-container" id="dst-gauge">
        <svg viewBox="0 0 200 120">
          <defs><linearGradient id="dst-grad"><stop offset="0%" stop-color="#ef4444"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#10b981"/></linearGradient></defs>
          <path d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="#334155" stroke-width="16"/>
          <path id="dst-arc" d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="url(#dst-grad)" stroke-width="16" stroke-linecap="round" stroke-dasharray="0 251.3"></path>
          <circle cx="100" cy="100" r="8" fill="#fff"></circle>
          <text x="100" y="65" text-anchor="middle" class="gauge-value" id="dst-value">--</text>
        </svg>
        <div class="needle" id="dst-needle"></div>
      </div>
      <div id="dst-info" class="loading"></div>
    </div>

    <!-- ISS Tracker -->
    <div class="card" id="iss-tracker-card" data-group="iss">
      <h2><i class="fas fa-satellite-dish"></i> ISS Tracking</h2>
      <div id="iss-map" style="height:300px;border-radius:12px;background:#000"></div>
      <small style="display:block;margin-top:8px;color:var(--text-muted)">Real-time International Space Station tracking</small>
    </div>

    <!-- Meteor Activity -->
    <div class="card" id="meteor-card" data-group="aurora">
      <h2><i class="fas fa-star-shooting"></i> Meteor Activity</h2>
      <div class="gauge-container" id="meteor-gauge">
        <svg viewBox="0 0 200 120">
          <defs><linearGradient id="meteor-grad"><stop offset="0%" stop-color="#10b981"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#ef4444"/></linearGradient></defs>
          <path d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="#334155" stroke-width="16"/>
          <path id="meteor-arc" d="M20 100 A80 80 0 1 1 180 100" fill="none" stroke="url(#meteor-grad)" stroke-width="16" stroke-linecap="round" stroke-dasharray="0 251.3"></path>
          <circle cx="100" cy="100" r="8" fill="#fff"></circle>
          <text x="100" y="65" text-anchor="middle" class="gauge-value" id="meteor-value">--</text>
        </svg>
        <div class="needle" id="meteor-needle"></div>
      </div>
      <div id="meteor-info" class="loading"></div>
    </div>

    <!-- Aurora Forecast -->
    <div class="card" id="aurora-forecast-card" data-group="aurora">
      <h2><i class="fas fa-cloud-aurora"></i> Aurora Forecast</h2>
      <div id="aurora-forecast" class="loading">Loading...</div>
    </div>

    <!-- System Status -->
    <div class="card full-width" id="system-status-card" data-group="overview">
      <h2><i class="fas fa-info-circle"></i> System Status</h2>
      <div id="system-status" class="loading">Checking...</div>
    </div>
  </div>
</main>
  <!-- Footer -->
  <footer>
    <p>Part of <a href="https://ournightsky.us" style="color:var(--cyan)">ournightsky.us</a> ‚Ä¢ Data: NOAA, NASA, & Aurora Service</p>
    <p>Auto-refresh every 2 minutes ‚Ä¢ Last run: <span id="last-run">--</span></p>
  </footer>

  <!-- Existing Scripts (unchanged from your original) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://the.gatekeeperconsent.com/cmp.min.js"></script>
  <script src="https://cmp.gatekeeperconsent.com/min.js" data-cfasync="false"></script>
  <script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
  <script src="https://www.dwin2.com/pub.2689578.min.js"></script>

  <!-- EXPORT / THEME TOGGLE / LAYOUT SAVE -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('theme-toggle');
      const userTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', userTheme);
      if (themeToggle) themeToggle.checked = userTheme === 'light';

      themeToggle?.addEventListener('change', () => {
        const newTheme = themeToggle.checked ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });

      const grid = document.querySelector('.main-content-grid');
      let dragSrc;

      if (grid) {
        const saved = JSON.parse(localStorage.getItem('dashboardOrder'));
        if (saved) {
          const items = Array.from(grid.children);
          saved.forEach(id => {
            const el = items.find(i => i.id === id);
            if (el) grid.appendChild(el);
          });
        }

        Array.from(grid.children).forEach(card => {
          if (!card.id) card.id = 'card-' + Math.random().toString(36).substr(2, 5);
          card.setAttribute('draggable', 'true');

          card.addEventListener('dragstart', e => dragSrc = e.target);
          card.addEventListener('dragover', e => {
            e.preventDefault();
            const target = e.target.closest('.card');
            if (target && target !== dragSrc) {
              const rect = target.getBoundingClientRect();
              const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
              grid.insertBefore(dragSrc, next ? target.nextSibling : target);
            }
          });
          card.addEventListener('dragend', () => {
            const order = Array.from(grid.children).map(c => c.id);
            localStorage.setItem('dashboardOrder', JSON.stringify(order));
          });
        });
      }

      window.exportDashboard = function () {
        const layout = Array.from(grid.children).map(c => c.id);
        const theme = document.documentElement.getAttribute('data-theme');
        const data = { layout, theme };
        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'dashboard-layout.json';
        a.click();
      }
    });
  </script>
</body>
</html>
